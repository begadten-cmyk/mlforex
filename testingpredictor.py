import pandas as pd
import numpy as np
import tensorflow as tf
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import LSTM, Dense
from sklearn.preprocessing import MinMaxScaler

# -------------------------------------------------------------------------
# 1) MANUAL DATA for GBPJPY (ALL rows exactly as you provided)
# -------------------------------------------------------------------------
data_rows = [
    # [Date, Open, High, Low, Close]
    # 2023
    ["2023-01-02",158.124,158.198,157.324,157.410],
    ["2023-01-03",157.410,158.375,155.347,156.755],
    ["2023-01-04",156.745,160.171,156.496,159.853],
    ["2023-01-05",159.917,160.038,158.504,158.913],
    ["2023-01-06",158.750,160.015,158.567,159.815],
    ["2023-01-09",159.280,161.234,159.206,160.675],
    ["2023-01-10",160.484,160.931,160.029,160.667],
    ["2023-01-11",160.573,161.203,160.400,160.964],
    ["2023-01-12",160.745,160.908,157.708,157.818],
    ["2023-01-13",157.790,158.048,155.637,156.432],
    ["2023-01-16",155.987,157.069,155.790,156.778],
    ["2023-01-17",156.635,158.027,156.378,157.412],
    ["2023-01-18",157.394,161.521,157.149,159.150],
    ["2023-01-19",159.110,159.217,157.564,159.100],
    ["2023-01-20",159.020,161.282,158.981,160.683],
    ["2023-01-23",160.494,161.798,160.357,161.767],
    ["2023-01-24",161.689,161.773,159.984,160.557],
    ["2023-01-25",160.427,160.919,159.493,160.693],
    ["2023-01-26",160.628,161.729,159.997,161.580],
    ["2023-01-27",161.515,161.606,160.402,160.965],
    ["2023-01-30",160.612,161.415,160.197,161.086],
    ["2023-01-31",161.002,161.190,159.760,160.272],
    ["2023-02-01",160.169,160.667,158.907,159.544],
    ["2023-02-02",159.490,159.609,157.178,157.317],
    ["2023-02-03",157.190,158.744,156.723,158.080],
    ["2023-02-06",159.214,159.949,158.473,159.409],
    ["2023-02-07",159.364,159.570,157.425,157.871],
    ["2023-02-08",157.829,158.833,157.602,158.604],
    ["2023-02-09",158.438,159.504,158.125,159.441],
    ["2023-02-10",159.368,159.625,157.525,158.405],
    ["2023-02-13",158.300,161.194,158.290,160.717],
    ["2023-02-14",160.651,162.175,160.100,162.038],
    ["2023-02-15",161.975,162.054,160.747,161.421],
    ["2023-02-16",161.253,161.508,160.462,160.574],
    ["2023-02-17",160.599,161.639,160.488,161.512],
    ["2023-02-20",161.356,161.724,161.163,161.578],
    ["2023-02-21",161.555,163.752,161.426,163.525],
    ["2023-02-22",163.470,163.557,162.387,162.516],
    ["2023-02-23",162.467,162.849,161.667,161.799],
    ["2023-02-24",161.769,163.117,161.193,162.947],
    ["2023-02-27",163.002,164.332,162.600,164.319],
    ["2023-02-28",164.306,166.009,163.711,163.752],
    ["2023-03-01",163.761,164.506,162.861,163.811],
    ["2023-03-02",163.774,163.930,163.062,163.386],
    ["2023-03-03",163.374,163.640,163.078,163.585],
    ["2023-03-06",163.428,163.787,162.976,163.474],
    ["2023-03-07",163.433,163.855,162.041,162.204],
    ["2023-03-08",162.172,162.978,161.700,162.690],
    ["2023-03-09",162.657,162.657,161.606,162.273],
    ["2023-03-10",162.324,164.307,161.943,162.487],
    ["2023-03-13",161.807,163.069,160.035,162.275],
    ["2023-03-14",162.273,164.079,161.856,163.130],
    ["2023-03-15",163.130,164.137,159.205,160.591],
    ["2023-03-16",160.591,162.104,158.555,161.739],
    ["2023-03-17",161.738,162.179,160.109,160.511],
    ["2023-03-20",160.847,161.723,158.953,161.131],
    ["2023-03-21",161.131,162.256,160.755,161.771],
    ["2023-03-22",161.765,163.337,160.783,161.123],
    ["2023-03-23",161.123,161.852,159.928,160.726],
    ["2023-03-24",160.726,160.833,158.257,159.879],
    ["2023-03-27",159.479,161.841,159.436,161.664],
    ["2023-03-28",161.643,161.771,160.731,161.538],
    ["2023-03-29",161.497,163.678,161.336,163.610],
    ["2023-03-30",163.611,164.447,162.970,164.377],
    ["2023-03-31",164.336,165.467,163.618,163.762],
    ["2023-04-03",164.326,164.897,163.422,164.410],
    ["2023-04-04",164.401,166.399,164.173,164.653],
    ["2023-04-05",164.630,164.667,162.764,163.553],
    ["2023-04-06",163.514,164.110,162.889,163.868],
    ["2023-04-07",163.818,164.398,163.513,164.097],
    ["2023-04-10",163.984,165.492,163.787,165.434],
    ["2023-04-11",165.395,166.190,165.185,166.131],
    ["2023-04-12",166.085,166.592,165.373,166.216],
    ["2023-04-13",166.191,166.843,165.399,166.026],
    ["2023-04-14",165.986,166.229,165.401,166.028],
    ["2023-04-17",165.933,166.630,165.690,166.445],
    ["2023-04-18",166.399,167.007,166.119,166.614],
    ["2023-04-19",166.597,167.968,166.485,167.519],
    ["2023-04-20",167.539,167.703,166.839,167.034],
    ["2023-04-21",167.021,167.078,165.511,166.896],
    ["2023-04-24",166.672,167.716,166.536,167.611],
    ["2023-04-25",167.608,167.954,165.420,165.950],
    ["2023-04-26",165.915,167.011,165.644,166.690],
    ["2023-04-27",166.593,167.503,166.312,167.444],
    ["2023-04-28",167.390,171.162,166.440,171.106],
    ["2023-05-01",170.876,172.083,170.867,171.726],
    ["2023-05-02",171.733,172.324,169.949,170.303],
    ["2023-05-03",170.249,170.374,169.141,169.413],
    ["2023-05-04",169.301,169.539,168.054,168.795],
    ["2023-05-05",168.787,170.612,168.484,170.276],
    ["2023-05-08",170.272,171.066,170.177,170.492],
    ["2023-05-09",170.467,170.711,169.853,170.677],
    ["2023-05-10",170.639,171.174,169.101,169.654],
    ["2023-05-11",169.606,169.740,167.839,168.376],
    ["2023-05-12",168.326,169.131,168.076,168.939],
    ["2023-05-15",168.815,170.621,168.773,170.498],
    ["2023-05-16",170.480,170.839,169.397,170.266],
    ["2023-05-17",170.229,172.004,170.067,171.817],
    ["2023-05-18",171.903,172.158,171.188,172.105],
    ["2023-05-19",172.091,172.509,171.243,171.705],
    ["2023-05-22",171.622,172.578,171.194,172.370],
    ["2023-05-23",172.337,172.622,171.280,172.061],
    ["2023-05-24",171.999,172.791,171.224,172.448],
    ["2023-05-25",172.414,172.772,171.682,172.544],
    ["2023-05-26",172.511,173.731,172.201,173.603],
    ["2023-05-29",173.377,173.952,172.946,173.522],
    ["2023-05-30",173.463,174.274,172.988,173.486],
    ["2023-05-31",173.480,173.643,172.525,173.338],
    ["2023-06-01",173.315,174.191,172.957,173.867],
    ["2023-06-02",173.818,174.676,173.663,174.254],
    ["2023-06-05",174.149,174.361,172.849,173.538],
    ["2023-06-06",173.522,173.773,172.672,173.493],
    ["2023-06-07",173.444,174.435,172.663,174.356],
    ["2023-06-08",174.291,174.513,173.900,174.456],
    ["2023-06-09",174.462,175.542,174.161,175.324],
    ["2023-06-12",175.060,175.767,174.350,174.684],
    ["2023-06-13",174.640,176.846,174.452,176.840],
    ["2023-06-14",176.804,177.406,176.442,177.393],
    ["2023-06-15",177.328,179.394,177.124,179.327],
    ["2023-06-16",179.295,182.044,178.821,181.894],
    ["2023-06-19",181.583,182.118,181.215,181.558],
    ["2023-06-20",181.611,182.088,179.921,180.493],
    ["2023-06-21",180.492,181.602,179.922,181.143],
    ["2023-06-22",181.012,182.557,180.707,182.424],
    ["2023-06-23",182.420,182.940,181.248,182.680],
    ["2023-06-26",182.308,182.985,181.681,182.411],
    ["2023-06-27",182.394,183.761,182.226,183.666],
    ["2023-06-28",183.666,183.683,182.142,182.552],
    ["2023-06-29",182.539,182.878,182.213,182.540],
    ["2023-06-30",182.555,183.873,182.198,183.190],
    ["2023-07-03",183.065,183.754,183.043,183.599],
    ["2023-07-04",183.615,183.906,183.229,183.669],
    ["2023-07-05",183.505,184.011,183.148,183.766],
    ["2023-07-06",183.735,184.004,182.497,183.530],
    ["2023-07-07",183.521,183.561,182.018,182.411],
    ["2023-07-10",182.312,183.220,181.095,181.732],
    ["2023-07-11",181.784,181.985,180.789,181.517],
    ["2023-07-12",181.514,181.514,179.466,179.858],
    ["2023-07-13",179.724,181.459,179.485,181.324],
    ["2023-07-14",181.317,182.283,180.188,181.815],
    ["2023-07-17",181.750,182.145,180.570,181.331],
    ["2023-07-18",181.429,181.839,180.359,180.972],
    ["2023-07-19",180.931,181.626,179.818,180.681],
    ["2023-07-20",180.566,180.715,179.692,180.226],
    ["2023-07-21",180.171,182.527,179.905,182.263],
    ["2023-07-24",181.901,182.341,180.746,181.447],
    ["2023-07-25",181.450,182.009,181.141,181.795],
    ["2023-07-26",181.734,181.949,180.907,181.480],
    ["2023-07-27",181.286,181.925,177.407,178.429],
    ["2023-07-28",178.470,181.489,176.305,181.370],
    ["2023-07-31",180.929,183.186,180.866,182.607],
    ["2023-08-01",182.642,183.250,182.439,183.090],
    ["2023-08-02",183.065,183.126,181.749,182.177],
    ["2023-08-03",182.168,182.760,180.424,181.164],
    ["2023-08-04",181.238,181.739,180.547,180.693],
    ["2023-08-07",180.437,182.189,180.433,182.139],
    ["2023-08-08",182.137,182.955,181.371,182.756],
    ["2023-08-09",182.755,183.019,182.300,182.796],
    ["2023-08-10",182.723,184.242,182.611,183.454],
    ["2023-08-11",183.450,184.230,183.229,184.018],
    ["2023-08-14",183.786,184.728,183.461,184.601],
    ["2023-08-15",184.478,185.322,184.286,184.917],
    ["2023-08-16",184.965,186.334,184.689,186.309],
    ["2023-08-17",186.110,186.468,185.553,185.875],
    ["2023-08-18",185.881,185.903,184.547,185.114],
    ["2023-08-21",184.884,186.656,184.880,186.504],
    ["2023-08-22",186.388,186.765,185.526,185.740],
    ["2023-08-23",185.721,185.940,183.367,184.325],
    ["2023-08-24",184.096,184.768,183.594,183.719],
    ["2023-08-25",183.717,184.405,183.352,184.145],
    ["2023-08-28",184.052,184.702,184.044,184.650],
    ["2023-08-29",184.658,185.262,184.066,184.431],
    ["2023-08-30",184.431,186.056,183.997,186.018],
    ["2023-08-31",185.879,186.025,184.078,184.426],
    ["2023-09-01",184.428,184.558,183.532,184.001],
    ["2023-09-04",183.892,185.081,183.766,184.882],
    ["2023-09-05",184.662,185.782,184.069,185.581],
    ["2023-09-06",185.587,185.616,184.242,184.681],
    ["2023-09-07",184.719,184.767,183.370,183.694],
    ["2023-09-08",183.675,184.462,183.057,184.222],
    ["2023-09-11",183.315,183.906,182.675,183.346],
    ["2023-09-12",183.350,183.928,182.941,183.634],
    ["2023-09-13",183.719,184.384,183.186,184.170],
    ["2023-09-14",184.062,184.157,182.510,182.981],
    ["2023-09-15",182.980,183.907,182.767,183.035],
    ["2023-09-18",182.856,183.342,182.718,182.759],
    ["2023-09-19",182.779,183.493,182.708,183.214],
    ["2023-09-20",183.123,183.345,182.453,183.098],
    ["2023-09-21",182.942,183.074,180.794,181.413],
    ["2023-09-22",181.423,182.304,181.203,181.564],
    ["2023-09-25",181.538,181.953,181.403,181.789],
    ["2023-09-26",181.796,181.807,181.044,181.222],
    ["2023-09-27",181.150,181.674,180.882,181.484],
    ["2023-09-28",181.295,182.418,181.056,182.200],
    ["2023-09-29",181.946,183.020,181.880,182.222],
    ["2023-10-02",182.148,182.814,181.112,181.125],
    ["2023-10-03",181.134,181.373,178.032,179.936],
    ["2023-10-04",179.826,181.256,179.559,180.943],
    ["2023-10-05",180.900,181.067,180.279,181.067],
    ["2023-10-06",180.898,182.974,180.584,182.650],
    ["2023-10-09",181.715,182.314,181.251,181.724],
    ["2023-10-10",181.735,182.781,181.531,182.700],
    ["2023-10-11",182.677,183.745,182.328,183.664],
    ["2023-10-12",183.645,183.814,182.330,182.379],
    ["2023-10-13",182.341,182.943,181.268,181.566],
    ["2023-10-16",181.045,182.728,181.045,182.660],
    ["2023-10-17",182.486,182.794,181.019,182.506],
    ["2023-10-18",182.474,182.803,181.837,182.009],
    ["2023-10-19",181.902,182.515,181.163,181.880],
    ["2023-10-20",181.881,182.362,181.279,182.268],
    ["2023-10-23",182.050,183.419,181.974,183.367],
    ["2023-10-24",183.272,183.741,182.042,182.288],
    ["2023-10-25",182.211,182.444,181.618,181.935],
    ["2023-10-26",181.890,182.574,181.107,182.365],
    ["2023-10-27",182.352,182.507,181.033,181.350],
    ["2023-10-30",181.272,181.867,180.756,181.311],
    ["2023-10-31",181.313,184.352,181.267,184.182],
    ["2023-11-01",184.183,184.258,182.932,183.335],
    ["2023-11-02",183.317,183.717,182.725,183.511],
    ["2023-11-03",183.556,185.009,183.213,184.907],
    ["2023-11-06",184.674,185.952,184.581,185.226],
    ["2023-11-07",185.203,185.449,184.637,184.887],
    ["2023-11-08",184.880,185.664,184.539,185.457],
    ["2023-11-09",185.430,185.883,184.835,184.973],
    ["2023-11-10",184.992,185.332,184.628,185.224],
    ["2023-11-13",184.733,186.309,184.733,186.272],
    ["2023-11-14",186.140,188.277,185.947,187.950],
    ["2023-11-15",187.937,188.267,187.180,187.928],
    ["2023-11-16",187.785,187.936,186.818,187.099],
    ["2023-11-17",187.017,187.131,185.304,186.463],
    ["2023-11-20",186.219,186.778,184.622,185.511],
    ["2023-11-21",185.515,186.087,184.454,186.053],
    ["2023-11-22",185.876,187.016,185.614,186.819],
    ["2023-11-23",186.731,187.665,186.271,187.450],
    ["2023-11-24",187.306,188.649,187.095,188.232],
    ["2023-11-27",188.091,188.516,187.589,187.716],
    ["2023-11-28",187.726,187.865,187.045,187.199],
    ["2023-11-29",187.161,187.523,186.616,186.893],
    ["2023-11-30",186.899,187.560,186.233,187.058],
    ["2023-12-01",186.999,187.517,186.190,186.577],
    ["2023-12-04",186.015,186.515,185.073,185.956],
    ["2023-12-05",185.956,186.183,185.061,185.273],
    ["2023-12-06",185.273,185.805,184.988,184.993],
    ["2023-12-07",184.940,184.990,178.600,181.476],
    ["2023-12-08",181.414,182.039,179.547,181.870],
    ["2023-12-11",181.555,184.325,181.449,183.485],
    ["2023-12-12",183.487,183.537,182.275,182.725],
    ["2023-12-13",182.628,183.139,180.194,180.282],
    ["2023-12-14",180.251,181.213,178.335,181.097],
    ["2023-12-15",181.029,181.725,179.808,180.217],
    ["2023-12-18",180.215,181.171,179.751,180.538],
    ["2023-12-19",180.550,184.175,180.016,183.090],
    ["2023-12-20",183.004,183.314,181.269,181.441],
    ["2023-12-21",181.439,181.439,179.775,180.293],
    ["2023-12-22",180.274,181.325,179.919,180.790],
    ["2023-12-25",180.989,181.063,180.941,180.974],
    ["2023-12-26",180.521,181.281,180.392,181.174],
    ["2023-12-27",180.938,182.192,180.864,181.501],
    ["2023-12-28",181.435,181.487,178.992,180.015],
    ["2023-12-29",179.973,180.533,179.303,179.516],

    # 2024
    ["2024-01-02",179.156,180.645,178.731,179.122],
    ["2024-01-03",179.104,181.736,178.726,181.466],
    ["2024-01-04",181.463,183.777,180.988,183.413],
    ["2024-01-05",183.232,184.327,183.158,183.908],
    ["2024-01-08",183.724,184.200,183.016,183.856],
    ["2024-01-09",183.846,183.910,182.747,183.581],
    ["2024-01-10",183.599,185.740,183.365,185.713],
    ["2024-01-11",185.740,186.160,184.899,185.302],
    ["2024-01-12",185.137,185.638,184.469,184.777],
    ["2024-01-15",184.553,185.751,184.394,185.446],
    ["2024-01-16",185.450,186.181,184.954,185.984],
    ["2024-01-17",185.999,188.117,185.671,187.805],
    ["2024-01-18",187.804,188.253,187.181,188.233],
    ["2024-01-19",188.247,188.902,187.405,188.205],
    ["2024-01-22",188.006,188.370,187.737,188.204],
    ["2024-01-23",188.205,188.898,187.331,188.175],
    ["2024-01-24",188.184,188.473,187.116,187.696],
    ["2024-01-25",187.700,188.191,187.150,187.631],
    ["2024-01-26",187.633,188.566,187.289,188.164],
    ["2024-01-29",187.657,188.270,187.110,187.432],
    ["2024-01-30",187.451,187.494,186.334,187.431],
    ["2024-01-31",187.431,187.617,185.904,186.374],
    ["2024-02-01",186.375,186.601,185.159,186.583],
    ["2024-02-02",186.588,187.729,186.243,187.404],
    ["2024-02-05",187.341,187.609,185.976,186.369],
    ["2024-02-06",186.367,186.780,186.149,186.349],
    ["2024-02-07",186.350,187.256,186.068,187.084],
    ["2024-02-08",187.087,188.465,186.774,188.394],
    ["2024-02-09",188.396,188.862,188.100,188.469],
    ["2024-02-12",188.322,188.701,187.842,188.603],
    ["2024-02-13",188.604,190.055,188.358,189.907],
    ["2024-02-14",189.873,189.873,188.743,189.192],
    ["2024-02-15",189.181,189.204,187.890,188.875],
    ["2024-02-16",188.880,189.493,188.528,189.248],
    ["2024-02-19",189.081,189.379,188.890,189.050],
    ["2024-02-20",189.020,189.714,188.821,189.335],
    ["2024-02-21",189.330,189.940,189.073,189.915],
    ["2024-02-22",189.914,190.821,189.751,190.572],
    ["2024-02-23",190.571,191.132,190.336,190.707],
    ["2024-02-26",190.750,191.309,190.309,191.157],
    ["2024-02-27",190.990,191.157,190.356,190.873],
    ["2024-02-28",190.901,190.922,190.244,190.778],
    ["2024-02-29",190.786,190.796,189.031,189.301],
    ["2024-03-01",189.326,190.384,189.011,189.914],
    ["2024-03-04",189.850,191.181,189.678,191.009],
    ["2024-03-05",191.011,191.050,190.288,190.661],
    ["2024-03-06",190.654,190.673,189.843,190.174],
    ["2024-03-07",190.140,190.173,188.217,189.613],
    ["2024-03-08",189.608,189.685,188.371,189.060],
    ["2024-03-11",188.993,189.013,187.909,188.277],
    ["2024-03-12",188.215,189.171,187.948,188.839],
    ["2024-03-13",188.839,189.544,188.408,188.905],
    ["2024-03-14",188.913,189.513,188.591,189.105],
    ["2024-03-15",189.105,190.024,188.579,189.801],
    ["2024-03-18",189.787,190.152,189.527,189.777],
    ["2024-03-19",189.783,192.159,189.620,191.792],
    ["2024-03-20",191.792,193.524,191.744,193.264],
    ["2024-03-21",193.264,193.496,191.775,191.854],
    ["2024-03-22",191.854,192.227,190.379,190.776],
    ["2024-03-25",190.726,191.567,190.335,191.299],
    ["2024-03-26",191.299,191.671,191.095,191.195],
    ["2024-03-27",191.195,191.522,190.498,191.064],
    ["2024-03-28",191.062,191.312,190.561,190.997],
    ["2024-03-29",191.002,191.229,190.771,190.990],
    ["2024-04-01",190.820,191.350,190.173,190.322],
    ["2024-04-02",190.327,190.711,190.038,190.608],
    ["2024-04-03",190.604,191.928,190.418,191.918],
    ["2024-04-04",191.916,192.243,191.007,191.318],
    ["2024-04-05",191.317,191.626,190.669,191.575],
    ["2024-04-08",191.297,192.186,191.292,192.125],
    ["2024-04-09",192.119,192.847,191.793,192.410],
    ["2024-04-10",192.404,192.924,191.466,192.049],
    ["2024-04-11",192.065,192.573,191.556,192.366],
    ["2024-04-12",192.374,192.395,189.986,190.795],
    ["2024-04-15",190.480,192.709,190.204,191.992],
    ["2024-04-16",191.985,192.806,191.642,192.226],
    ["2024-04-17",192.228,192.830,191.669,192.255],
    ["2024-04-18",192.264,192.774,191.893,192.303],
    ["2024-04-19",192.289,192.721,190.293,191.254],
    ["2024-04-22",191.320,191.693,190.316,191.220],
    ["2024-04-23",191.222,192.843,190.828,192.734],
    ["2024-04-24",192.726,193.627,192.336,193.605],
    ["2024-04-25",193.605,194.943,193.106,194.759],
    ["2024-04-26",194.757,197.905,193.958,197.812],
    ["2024-04-29",197.030,200.539,193.603,196.412],
    ["2024-04-30",196.398,197.369,195.930,197.111],
    ["2024-05-01",196.986,197.420,191.766,193.681],
    ["2024-05-02",193.623,195.744,191.850,192.624],
    ["2024-05-03",192.549,192.644,191.352,191.884],
    ["2024-05-06",191.820,193.664,191.539,193.296],
    ["2024-05-07",193.285,194.124,192.982,193.484],
    ["2024-05-08",193.483,194.510,193.012,194.379],
    ["2024-05-09",194.373,194.854,193.833,194.712],
    ["2024-05-10",194.698,195.337,194.357,195.075],
    ["2024-05-13",194.890,196.275,194.735,196.165],
    ["2024-05-14",196.158,197.051,195.713,196.944],
    ["2024-05-15",196.916,197.089,195.877,196.456],
    ["2024-05-16",196.472,196.905,195.036,196.839],
    ["2024-05-17",196.856,197.849,196.671,197.647],
    ["2024-05-20",197.480,198.639,197.253,198.522],
    ["2024-05-21",198.503,198.903,198.267,198.457],
    ["2024-05-22",198.438,199.531,198.228,199.365],
    ["2024-05-23",199.371,199.889,199.018,199.236],
    ["2024-05-24",199.237,200.062,198.906,199.892],
    ["2024-05-27",199.870,200.424,199.610,200.374],
    ["2024-05-28",200.382,200.643,200.051,200.528],
    ["2024-05-29",200.536,200.738,200.047,200.213],
    ["2024-05-30",200.204,200.235,198.749,199.605],
    ["2024-05-31",199.642,200.505,199.238,200.355],
    ["2024-06-03",200.220,200.645,199.221,199.869],
    ["2024-06-04",199.871,200.416,197.202,197.788],
    ["2024-06-05",197.833,199.746,197.482,199.562],
    ["2024-06-06",199.543,199.935,198.831,199.018],
    ["2024-06-07",198.875,199.808,198.392,199.363],
    ["2024-06-10",199.450,200.044,198.930,199.869],
    ["2024-06-11",199.867,200.392,199.625,200.175],
    ["2024-06-12",200.168,200.933,199.854,200.550],
    ["2024-06-13",200.550,201.311,199.688,200.389],
    ["2024-06-14",200.382,201.612,198.918,199.654],
    ["2024-06-17",199.650,200.449,199.058,200.378],
    ["2024-06-18",200.343,200.844,200.015,200.618],
    ["2024-06-19",200.623,201.112,200.244,201.062],
    ["2024-06-20",201.081,201.389,200.788,201.151],
    ["2024-06-21",201.152,202.044,200.449,202.003],
    ["2024-06-24",201.899,202.697,201.129,202.470],
    ["2024-06-25",202.428,202.724,201.959,202.586],
    ["2024-06-26",202.552,203.145,202.301,202.973],
    ["2024-06-27",202.858,203.382,202.501,203.176],
    ["2024-06-28",203.189,203.589,202.563,203.424],
    ["2024-07-01",203.440,204.724,203.198,204.254],
    ["2024-07-02",204.197,204.383,203.882,204.126],
    ["2024-07-03",204.803,206.164,204.421,206.042],
    ["2024-07-04",206.032,206.069,205.284,205.775],
    ["2024-07-05",205.765,206.435,204.983,206.023],
    ["2024-07-08",205.700,206.664,205.288,205.956],
    ["2024-07-09",205.918,206.582,205.828,206.281],
    ["2024-07-10",206.268,207.814,206.015,207.725],
    ["2024-07-11",207.733,208.110,203.824,205.150],
    ["2024-07-12",205.142,206.336,203.814,205.029],
    ["2024-07-15",205.050,205.397,204.133,204.998],
    ["2024-07-16",204.902,205.787,204.769,205.441],
    ["2024-07-17",205.298,205.688,203.016,203.212],
    ["2024-07-18",203.135,203.862,202.095,203.673],
    ["2024-07-19",203.680,204.217,202.945,203.288],
    ["2024-07-22",203.037,203.608,201.889,203.046],
    ["2024-07-23",203.041,203.156,200.743,200.799],
    ["2024-07-24",200.788,201.177,197.768,198.575],
    ["2024-07-25",198.593,198.796,195.860,197.833],
    ["2024-07-26",197.849,199.139,196.896,197.752],
    ["2024-07-29",197.620,198.603,196.784,198.080],
    ["2024-07-30",198.054,199.464,195.975,196.049],
    ["2024-07-31",196.058,197.545,192.163,192.800],
    ["2024-08-01",192.794,193.249,190.159,190.258],
    ["2024-08-02",190.320,190.500,187.381,187.553],
    ["2024-08-05",187.562,187.628,180.075,184.211],
    ["2024-08-06",184.213,187.070,182.803,183.134],
    ["2024-08-07",183.131,188.063,182.902,186.128],
    ["2024-08-08",186.129,187.868,184.469,187.709],
    ["2024-08-09",187.700,188.406,186.470,187.007],
    ["2024-08-12",186.946,189.321,186.896,187.915],
    ["2024-08-13",187.914,189.504,187.572,188.839],
    ["2024-08-14",188.863,189.422,187.852,189.000],
    ["2024-08-15",188.866,191.999,188.747,191.887],
    ["2024-08-16",191.846,192.001,190.367,190.975],
    ["2024-08-19",191.002,191.620,188.229,190.407],
    ["2024-08-20",190.338,191.256,189.222,189.329],
    ["2024-08-21",189.327,191.404,188.921,190.080],
    ["2024-08-22",190.154,191.912,189.625,191.474],
    ["2024-08-23",191.458,192.019,190.264,190.673],
    ["2024-08-26",190.321,190.781,189.499,190.566],
    ["2024-08-27",190.589,191.914,190.231,190.879],
    ["2024-08-28",190.818,191.442,190.348,190.697],
    ["2024-08-29",190.722,191.535,190.250,190.950],
    ["2024-08-30",190.956,192.008,190.487,191.822],
    ["2024-09-02",191.765,193.465,191.326,193.151],
    ["2024-09-03",193.166,193.351,190.313,190.764],
    ["2024-09-04",190.737,190.839,188.922,188.936],
    ["2024-09-05",188.935,189.774,188.061,189.054],
    ["2024-09-06",188.970,189.397,186.512,186.746],
    ["2024-09-09",186.558,188.121,186.407,187.177],
    ["2024-09-10",187.189,188.089,185.721,186.321],
    ["2024-09-11",186.322,186.363,183.711,185.666],
    ["2024-09-12",185.640,186.730,185.281,186.116],
    ["2024-09-13",186.095,186.198,184.362,184.739],
    ["2024-09-16",184.658,186.032,183.763,185.823],
    ["2024-09-17",185.824,187.448,185.286,187.409],
    ["2024-09-18",187.401,188.044,185.823,187.988],
    ["2024-09-19",187.989,190.383,187.416,189.445],
    ["2024-09-20",189.439,191.986,188.708,191.558],
    ["2024-09-23",191.408,192.428,190.125,191.659],
    ["2024-09-24",191.644,193.315,191.230,192.090],
    ["2024-09-25",192.043,193.254,191.770,192.851],
    ["2024-09-26",192.844,194.345,192.503,194.265],
    ["2024-09-27",194.248,195.956,189.999,190.093],
    ["2024-09-30",190.041,192.304,189.553,192.087],
    ["2024-10-01",192.082,193.352,189.846,190.723],
    ["2024-10-02",190.719,194.416,190.406,194.297],
    ["2024-10-03",194.330,195.165,192.116,192.824],
    ["2024-10-04",192.828,195.519,191.721,195.101],
    ["2024-10-07",194.873,195.616,193.338,193.861],
    ["2024-10-08",193.832,194.366,192.879,194.197],
    ["2024-10-09",194.179,195.243,193.581,195.134],
    ["2024-10-10",195.128,195.496,193.567,194.030],
    ["2024-10-11",193.947,195.230,193.738,194.778],
    ["2024-10-14",194.544,195.706,194.544,195.556],
    ["2024-10-15",195.564,195.721,194.638,195.042],
    ["2024-10-16",195.099,195.275,193.698,194.358],
    ["2024-10-17",194.386,195.595,193.825,195.399],
    ["2024-10-18",195.302,196.046,194.751,195.066],
    ["2024-10-21",194.980,195.882,194.562,195.830],
    ["2024-10-22",195.837,196.510,195.096,196.132],
    ["2024-10-23",196.137,198.425,195.688,197.373],
    ["2024-10-24",197.370,197.622,196.424,196.987],
    ["2024-10-25",196.982,197.769,196.377,197.390],
    ["2024-10-28",198.182,199.347,197.804,198.734],
    ["2024-10-29",198.733,199.706,198.032,199.455],
    ["2024-10-30",199.454,199.797,198.197,198.761],
    ["2024-10-31",198.720,198.900,195.372,196.028],
    ["2024-11-01",196.027,198.357,195.776,197.570],
    ["2024-11-04",197.487,197.792,196.491,197.100],
    ["2024-11-05",197.102,197.870,196.922,197.715],
    ["2024-11-06",197.718,199.516,197.210,199.120],
    ["2024-11-07",199.001,199.550,198.293,198.563],
    ["2024-11-08",198.536,198.913,196.732,197.173],
    ["2024-11-11",197.036,198.457,196.625,197.798],
    ["2024-11-12",197.708,198.051,196.874,197.074],
    ["2024-11-13",196.989,197.807,196.650,197.543],
    ["2024-11-14",197.444,198.234,197.071,197.892],
    ["2024-11-15",197.883,198.436,194.293,194.799],
    ["2024-11-18",194.592,196.143,194.360,196.048],
    ["2024-11-19",196.035,196.210,193.555,196.109],
    ["2024-11-20",196.106,197.777,195.898,196.554],
    ["2024-11-21",196.578,196.633,194.363,194.453],
    ["2024-11-22",194.439,194.802,192.845,193.911],
    ["2024-11-25",194.027,194.614,193.265,193.770],
    ["2024-11-26",193.831,193.831,192.033,192.415],
    ["2024-11-27",192.417,192.619,190.687,191.499],
    ["2024-11-28",191.382,192.464,191.278,192.209],
    ["2024-11-29",192.126,192.267,190.154,190.551],
    ["2024-12-02",190.378,191.282,188.465,189.243],
    ["2024-12-03",189.241,190.373,188.079,189.487],
    ["2024-12-04",189.497,191.525,189.354,191.198],
    ["2024-12-05",191.222,192.206,190.337,191.422],
    ["2024-12-06",191.433,192.364,190.718,191.182],
    ["2024-12-09",190.941,193.401,190.600,192.725],
    ["2024-12-10",192.801,194.101,192.422,193.957],
    ["2024-12-11",193.905,194.773,192.524,194.280],
    ["2024-12-12",194.375,194.993,192.930,193.335],
    ["2024-12-13",193.431,194.452,192.846,193.869],
    ["2024-12-16",193.820,195.880,193.646,195.402],
    ["2024-12-17",195.407,195.892,194.649,194.934],
    ["2024-12-18",194.953,195.760,194.070,194.573],
]

# -------------------------------------------------------------------------
# 2) LOAD THE DATA
# -------------------------------------------------------------------------
def load_gbpjpy_data():
    df = pd.DataFrame(data_rows, columns=["Date","Open","High","Low","Close"])
    df["Date"] = pd.to_datetime(df["Date"])
    df.sort_values("Date", inplace=True)
    df.set_index("Date", inplace=True)
    return df

# -------------------------------------------------------------------------
# 3) BUILD SEQUENCES FOR LSTM
#    We'll use 'lookback=10' days to predict the next day's High, Low, Close.
# -------------------------------------------------------------------------
def build_lstm_sequences(df, lookback=10):
    # Get numeric array of [Open, High, Low, Close]
    arr = df[["Open","High","Low","Close"]].values
    X_seq = []
    Y_high = []
    Y_low  = []
    Y_close= []
    
    # For i in range(len(arr)-lookback):
    #   X_seq[i] = arr[i : i+lookback]
    #   Next day is arr[i+lookback]
    #   So Y_* = arr[i+lookback][1, 2, 3]
    for i in range(len(arr)-lookback):
        X_seq.append(arr[i : i+lookback])
        # Next day
        tomorrow = arr[i+lookback]
        # tomorrow[1] = next day's High
        # tomorrow[2] = next day's Low
        # tomorrow[3] = next day's Close
        Y_high.append(tomorrow[1])
        Y_low.append(tomorrow[2])
        Y_close.append(tomorrow[3])

    X_seq = np.array(X_seq, dtype=np.float32)
    Y_high= np.array(Y_high, dtype=np.float32)
    Y_low = np.array(Y_low,  dtype=np.float32)
    Y_close= np.array(Y_close,dtype=np.float32)

    return X_seq, Y_high, Y_low, Y_close

# -------------------------------------------------------------------------
# 4) SCALE DATA? (OPTIONAL)
#    For demonstration, let's apply MinMaxScaler( ) across all columns.
# -------------------------------------------------------------------------
def scale_df(df):
    # We'll scale [Open,High,Low,Close] columns between 0..1
    # Then put them back into df.
    scaler = MinMaxScaler()
    df_scaled = df.copy()
    arr = df[["Open","High","Low","Close"]].values
    arr_scaled = scaler.fit_transform(arr)
    df_scaled[["Open","High","Low","Close"]] = arr_scaled
    return df_scaled, scaler

# -------------------------------------------------------------------------
# 5) BUILD & TRAIN 3 SEPARATE LSTM MODELS (one for High, one for Low, one for Close)
# -------------------------------------------------------------------------
def create_lstm_model(input_shape):
    model = Sequential()
    model.add(LSTM(64, return_sequences=False, input_shape=input_shape))
    model.add(Dense(1))  # single output
    model.compile(optimizer='adam', loss='mean_squared_error')
    return model

def train_lstm_models(X, Y_high, Y_low, Y_close, epochs=10):
    # X shape: (samples, lookback, 4 features)
    # Y shape: (samples,)
    input_shape = (X.shape[1], X.shape[2])  # (lookback, num_features=4)

    model_high  = create_lstm_model(input_shape)
    model_low   = create_lstm_model(input_shape)
    model_close = create_lstm_model(input_shape)

    # Fit each model
    print("Training model for HIGH ...")
    model_high.fit(X, Y_high, epochs=epochs, batch_size=16, verbose=0)

    print("Training model for LOW ...")
    model_low.fit(X, Y_low, epochs=epochs, batch_size=16, verbose=0)

    print("Training model for CLOSE ...")
    model_close.fit(X, Y_close, epochs=epochs, batch_size=16, verbose=0)

    return model_high, model_low, model_close

# -------------------------------------------------------------------------
# 6) PREDICT FOR 2025-01-03
#    We'll take the last 10 days prior to 2025-01-02 to feed as LSTM input
# -------------------------------------------------------------------------
def predict_tomorrow_lstm(df_original, df_scaled, scaler, model_high, model_low, model_close, lookback=10):
    # We'll form the last 'lookback' days from the scaled df
    # Then feed it to each model to get next day's predicted High, Low, Close in scaled form
    arr_scaled = df_scaled[["Open","High","Low","Close"]].values

    # last 10 rows -> shape=(10,4)
    last_seq = arr_scaled[-lookback:]  # these are scaled values
    last_seq = np.expand_dims(last_seq, axis=0)  # shape=(1,10,4)

    # Predict scaled
    pred_h_scaled = model_high.predict(last_seq)[0][0]   # single value
    pred_l_scaled = model_low.predict(last_seq)[0][0]
    pred_c_scaled = model_close.predict(last_seq)[0][0]

    # We have to invert the scale to get real values
    # We can build a dummy array of shape (1,4) and place these predictions in the correct columns
    # Then do scaler.inverse_transform(...)
    # Our columns = [Open, High, Low, Close] = indices [0,1,2,3]
    dummy_row = np.zeros((1,4))
    dummy_row[0,1] = pred_h_scaled
    dummy_row[0,2] = pred_l_scaled
    dummy_row[0,3] = pred_c_scaled

    # Inverse
    inv = scaler.inverse_transform(dummy_row)
    pred_h = inv[0,1]
    pred_l = inv[0,2]
    pred_c = inv[0,3]

    print("\n=== LSTM PREDICTION FOR 2025-01-03 ===")
    print(f"Predicted HIGH:  {pred_h:.5f}")
    print(f"Predicted LOW:   {pred_l:.5f}")
    print(f"Predicted CLOSE: {pred_c:.5f}")

# -------------------------------------------------------------------------
# 7) MAIN
# -------------------------------------------------------------------------
def main():
    # 1) Load original df
    df_original = load_gbpjpy_data()
    print(f"Loaded data with shape={df_original.shape}")
    
    # 2) Scale
    df_scaled, scaler = scale_df(df_original)
    
    # 3) Build sequences from scaled data
    lookback = 10
    X_seq, Y_high, Y_low, Y_close = build_lstm_sequences(df_scaled, lookback=lookback)
    print(f"X_seq.shape={X_seq.shape}, Y_high.shape={Y_high.shape}")
    
    # 4) Train LSTM models
    model_high, model_low, model_close = train_lstm_models(X_seq, Y_high, Y_low, Y_close, epochs=10)
    
    # 5) Predict for 2025-01-03
    predict_tomorrow_lstm(df_original, df_scaled, scaler, 
                          model_high, model_low, model_close, 
                          lookback=lookback)

if __name__ == "__main__":
    main()
