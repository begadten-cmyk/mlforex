import pandas as pd
import numpy as np
from datetime import datetime

# Scikit-Learn imports
from sklearn.linear_model import SGDClassifier
from sklearn.linear_model import SGDRegressor

############################################################################
# 1) YOUR DATA (multiline string)
############################################################################

DATA = """
DATE    OPEN    HIGH    LOW     CLOSE
2023.01.02  0.88524 0.88740 0.88381 0.88530
2023.01.03  0.88512 0.88625 0.87828 0.88118
2023.01.04  0.88044 0.88212 0.87821 0.87953
2023.01.05  0.87944 0.88628 0.87803 0.88301
2023.01.06  0.88319 0.88709 0.87971 0.87984
2023.01.09  0.87935 0.88237 0.87691 0.88069
2023.01.10  0.88069 0.88463 0.87864 0.88332
2023.01.11  0.88322 0.88817 0.88154 0.88521
2023.01.12  0.88508 0.88954 0.88325 0.88863
2023.01.13  0.88826 0.88973 0.88502 0.88519
2023.01.16  0.88554 0.88792 0.88464 0.88735
2023.01.17  0.88642 0.88873 0.87769 0.87800
2023.01.18  0.87761 0.88035 0.87348 0.87428
2023.01.19  0.87395 0.87873 0.87216 0.87395
2023.01.20  0.87371 0.87863 0.87351 0.87534
2023.01.23  0.87537 0.88151 0.87518 0.87853
2023.01.24  0.87813 0.88470 0.87671 0.88238
2023.01.25  0.88221 0.88521 0.87987 0.88001
2023.01.26  0.87979 0.88146 0.87728 0.87748
2023.01.27  0.87748 0.88047 0.87627 0.87642
2023.01.30  0.87624 0.88034 0.87550 0.87838
2023.01.31  0.87849 0.88299 0.87722 0.88150
2023.02.01  0.88159 0.88834 0.88035 0.88803
2023.02.02  0.88730 0.89557 0.88686 0.89235
2023.02.03  0.89230 0.89790 0.89116 0.89556
2023.02.06  0.89479 0.89648 0.89150 0.89215
2023.02.07  0.89204 0.89408 0.88978 0.89026
2023.02.08  0.88988 0.89111 0.88735 0.88735
2023.02.09  0.88719 0.88842 0.88384 0.88604
2023.02.10  0.88597 0.88728 0.88239 0.88546
2023.02.13  0.88439 0.88749 0.88233 0.88337
2023.02.14  0.88332 0.88482 0.88027 0.88184
2023.02.15  0.88165 0.89026 0.88131 0.88804
2023.02.16  0.88794 0.89094 0.88698 0.89000
2023.02.17  0.88943 0.89288 0.88728 0.88798
2023.02.20  0.88795 0.88918 0.88706 0.88724
2023.02.21  0.88713 0.88867 0.87886 0.87899
2023.02.22  0.87864 0.88226 0.87836 0.88029
2023.02.23  0.87948 0.88238 0.87929 0.88164
2023.02.24  0.88141 0.88361 0.87980 0.88319
2023.02.27  0.88085 0.88357 0.87895 0.87957
2023.02.28  0.87932 0.88119 0.87551 0.87961
2023.03.01  0.87946 0.88966 0.87743 0.88718
2023.03.02  0.88694 0.88919 0.88479 0.88694
2023.03.03  0.88678 0.88700 0.88265 0.88283
2023.03.06  0.88233 0.88875 0.88203 0.88828
2023.03.07  0.88818 0.89254 0.88506 0.89201
2023.03.08  0.89185 0.89222 0.88902 0.89029
2023.03.09  0.89007 0.89139 0.88656 0.88757
2023.03.10  0.88741 0.88899 0.88195 0.88413
2023.03.13  0.88424 0.88635 0.87950 0.88049
2023.03.14  0.88040 0.88364 0.87779 0.88274
2023.03.15  0.88291 0.88437 0.87186 0.87702
2023.03.16  0.87702 0.88192 0.87477 0.87605
2023.03.17  0.87604 0.87831 0.87452 0.87580
2023.03.20  0.87506 0.87688 0.87243 0.87313
2023.03.21  0.87314 0.88397 0.87299 0.88105
2023.03.22  0.88106 0.88540 0.87720 0.88507
2023.03.23  0.88480 0.88656 0.88105 0.88129
2023.03.24  0.88129 0.88270 0.87773 0.87969
2023.03.27  0.87990 0.88067 0.87758 0.87868
2023.03.28  0.87861 0.88074 0.87709 0.87888
2023.03.29  0.87876 0.88116 0.87757 0.88047
2023.03.30  0.88036 0.88285 0.87795 0.88034
2023.03.31  0.88013 0.88078 0.87767 0.87926
2023.04.03  0.87881 0.88069 0.87712 0.87804
2023.04.04  0.87780 0.87859 0.87292 0.87638
2023.04.05  0.87629 0.87857 0.87452 0.87523
2023.04.06  0.87513 0.87857 0.87394 0.87785
2023.04.07  0.87780 0.87903 0.87656 0.87763
2023.04.10  0.87603 0.87919 0.87603 0.87716
2023.04.11  0.87691 0.87896 0.87591 0.87827
2023.04.12  0.87812 0.88196 0.87776 0.88032
2023.04.13  0.88019 0.88388 0.87921 0.88209
2023.04.14  0.88195 0.88600 0.88128 0.88555
2023.04.17  0.88413 0.88645 0.88209 0.88297
2023.04.18  0.88273 0.88330 0.88094 0.88302
2023.04.19  0.88297 0.88381 0.87917 0.88085
2023.04.20  0.88037 0.88258 0.87885 0.88158
2023.04.21  0.88149 0.88614 0.88076 0.88314
2023.04.24  0.88246 0.88595 0.88239 0.88469
2023.04.25  0.88454 0.88753 0.88402 0.88425
2023.04.26  0.88408 0.88735 0.88363 0.88545
2023.04.27  0.88524 0.88720 0.88226 0.88234
2023.04.28  0.88229 0.88392 0.87644 0.87652
2023.05.01  0.87666 0.87945 0.87601 0.87852
2023.05.02  0.87823 0.88246 0.87633 0.88218
2023.05.03  0.88207 0.88350 0.87958 0.88031
2023.05.04  0.88020 0.88145 0.87455 0.87609
2023.05.05  0.87571 0.87678 0.87129 0.87237
2023.05.08  0.87154 0.87465 0.87102 0.87204
2023.05.09  0.87190 0.87225 0.86794 0.86839
2023.05.10  0.86835 0.87011 0.86703 0.86993
2023.05.11  0.86973 0.87348 0.86612 0.87240
2023.05.12  0.87225 0.87322 0.86934 0.87162
2023.05.15  0.87063 0.87190 0.86773 0.86805
2023.05.16  0.86792 0.87185 0.86706 0.87007
2023.05.17  0.86994 0.87209 0.86702 0.86802
2023.05.18  0.86780 0.87021 0.86677 0.86806
2023.05.19  0.86775 0.86956 0.86684 0.86811
2023.05.22  0.86749 0.87046 0.86727 0.86937
2023.05.23  0.86920 0.87189 0.86689 0.86751
2023.05.24  0.86743 0.87096 0.86489 0.86934
2023.05.25  0.86922 0.87057 0.86656 0.87047
2023.05.26  0.87027 0.87098 0.86767 0.86848
2023.05.29  0.86763 0.86950 0.86656 0.86673
2023.05.30  0.86648 0.86735 0.86283 0.86483
2023.05.31  0.86448 0.86502 0.85835 0.85901
2023.06.01  0.85891 0.86044 0.85674 0.85911
2023.06.02  0.85900 0.86054 0.85783 0.85988
2023.06.05  0.85913 0.86360 0.85853 0.86150
2023.06.06  0.86137 0.86246 0.86000 0.86070
2023.06.07  0.86045 0.86128 0.85838 0.86010
2023.06.08  0.85997 0.86139 0.85833 0.85853
2023.06.09  0.85832 0.85907 0.85412 0.85442
2023.06.12  0.85389 0.86068 0.85308 0.85971
2023.06.13  0.85963 0.86129 0.85534 0.85579
2023.06.14  0.85565 0.85622 0.85411 0.85547
2023.06.15  0.85514 0.85915 0.85420 0.85623
2023.06.16  0.85594 0.85659 0.85215 0.85329
2023.06.19  0.85268 0.85480 0.85183 0.85419
2023.06.20  0.85331 0.85812 0.85272 0.85499
2023.06.21  0.85479 0.86088 0.85246 0.86020
2023.06.22  0.85983 0.86364 0.85718 0.85882
2023.06.23  0.85905 0.86080 0.85358 0.85634
2023.06.26  0.85737 0.85948 0.85429 0.85777
2023.06.27  0.85767 0.86134 0.85677 0.85957
2023.06.28  0.85960 0.86582 0.85872 0.86354
2023.06.29  0.86353 0.86436 0.86101 0.86106
2023.06.30  0.86108 0.86177 0.85761 0.85896
2023.07.03  0.85879 0.86055 0.85779 0.85939
2023.07.04  0.85918 0.86000 0.85537 0.85551
2023.07.05  0.85539 0.85760 0.85420 0.85421
2023.07.06  0.85424 0.85644 0.85207 0.85464
2023.07.07  0.85419 0.85542 0.85252 0.85395
2023.07.10  0.85363 0.85843 0.85309 0.85525
2023.07.11  0.85526 0.85612 0.85039 0.85107
2023.07.12  0.85111 0.85757 0.84996 0.85694
2023.07.13  0.85669 0.85749 0.85350 0.85452
2023.07.14  0.85453 0.85744 0.85365 0.85739
2023.07.17  0.85677 0.85983 0.85561 0.85938
2023.07.18  0.85938 0.86141 0.85768 0.86119
2023.07.19  0.86119 0.87014 0.85949 0.86559
2023.07.20  0.86529 0.86982 0.86478 0.86480
2023.07.21  0.86355 0.86800 0.86342 0.86544
2023.07.24  0.86494 0.86593 0.86193 0.86256
2023.07.25  0.86257 0.86371 0.85651 0.85685
2023.07.26  0.85673 0.85864 0.85608 0.85654
2023.07.27  0.85625 0.85994 0.85442 0.85783
2023.07.28  0.85752 0.85894 0.85497 0.85686
2023.07.31  0.85629 0.85909 0.85564 0.85660
2023.08.01  0.85612 0.86068 0.85506 0.85960
2023.08.02  0.85896 0.86290 0.85779 0.86039
2023.08.03  0.86035 0.86554 0.85830 0.86143
2023.08.04  0.86062 0.86480 0.86009 0.86302
2023.08.07  0.86236 0.86362 0.86046 0.86046
2023.08.08  0.86042 0.86256 0.85924 0.85924
2023.08.09  0.85901 0.86346 0.85872 0.86267
2023.08.10  0.86176 0.86658 0.86118 0.86624
2023.08.11  0.86585 0.86689 0.86179 0.86209
2023.08.14  0.86260 0.86326 0.85908 0.85947
2023.08.15  0.85942 0.86098 0.85740 0.85810
2023.08.16  0.85844 0.85931 0.85436 0.85449
2023.08.17  0.85409 0.85574 0.85232 0.85295
2023.08.18  0.85285 0.85577 0.85164 0.85330
2023.08.21  0.85380 0.85631 0.85268 0.85414
2023.08.22  0.85373 0.85456 0.85135 0.85173
2023.08.23  0.85173 0.85658 0.84925 0.85352
2023.08.24  0.85349 0.85819 0.85331 0.85780
2023.08.25  0.85792 0.85855 0.85604 0.85776
2023.08.28  0.85738 0.85990 0.85676 0.85852
2023.08.29  0.85838 0.86102 0.85651 0.86034
2023.08.30  0.86028 0.86106 0.85843 0.85852
2023.08.31  0.85850 0.85981 0.85542 0.85545
2023.09.01  0.85553 0.85733 0.85477 0.85569
2023.09.04  0.85580 0.85597 0.85435 0.85450
2023.09.05  0.85457 0.85769 0.85238 0.85312
2023.09.06  0.85288 0.85781 0.85255 0.85743
2023.09.07  0.85668 0.86016 0.85644 0.85745
2023.09.08  0.85732 0.85926 0.85687 0.85807
2023.09.11  0.85772 0.85935 0.85579 0.85920
2023.09.12  0.85835 0.86128 0.85698 0.86102
2023.09.13  0.86074 0.86306 0.85888 0.85896
2023.09.14  0.85902 0.86152 0.85728 0.85765
2023.09.15  0.85747 0.86157 0.85612 0.86064
2023.09.18  0.86011 0.86330 0.85817 0.86323
2023.09.19  0.86232 0.86368 0.86028 0.86158
2023.09.20  0.86107 0.86596 0.86107 0.86341
2023.09.21  0.86337 0.86957 0.86267 0.86689
2023.09.22  0.86561 0.87002 0.86503 0.86934
2023.09.25  0.86708 0.87023 0.86684 0.86732
2023.09.26  0.86732 0.87060 0.86613 0.86941
2023.09.27  0.86820 0.87024 0.86524 0.86527
2023.09.28  0.86528 0.86609 0.86302 0.86559
2023.09.29  0.86511 0.86802 0.86418 0.86592
2023.10.02  0.86598 0.86752 0.86517 0.86665
2023.10.03  0.86597 0.86912 0.86575 0.86648
2023.10.04  0.86599 0.86823 0.86398 0.86542
2023.10.05  0.86394 0.86743 0.86290 0.86513
2023.10.06  0.86390 0.86629 0.86390 0.86451
2023.10.09  0.86418 0.86581 0.86319 0.86330
2023.10.10  0.86314 0.86553 0.86285 0.86303
2023.10.11  0.86319 0.86425 0.86160 0.86223
2023.10.12  0.86076 0.86519 0.86047 0.86455
2023.10.13  0.86412 0.86647 0.86326 0.86510
2023.10.16  0.86444 0.86713 0.86402 0.86427
2023.10.17  0.86465 0.86904 0.86345 0.86802
2023.10.18  0.86790 0.86880 0.86600 0.86772
2023.10.19  0.86771 0.87174 0.86679 0.87111
2023.10.20  0.87116 0.87403 0.86958 0.87077
2023.10.23  0.87160 0.87252 0.86978 0.87100
2023.10.24  0.87082 0.87135 0.86827 0.87067
2023.10.25  0.87050 0.87266 0.86871 0.87229
2023.10.26  0.87184 0.87343 0.86910 0.87070
2023.10.27  0.87081 0.87265 0.86943 0.87118
2023.10.30  0.87093 0.87404 0.87067 0.87227
2023.10.31  0.87231 0.87536 0.86961 0.87019
2023.11.01  0.87017 0.87121 0.86824 0.86938
2023.11.02  0.86938 0.87354 0.86890 0.87033
2023.11.03  0.87020 0.87212 0.86610 0.86637
2023.11.06  0.86615 0.86860 0.86496 0.86817
2023.11.07  0.86649 0.87036 0.86649 0.86976
2023.11.08  0.86979 0.87176 0.86814 0.87154
2023.11.09  0.87148 0.87296 0.86925 0.87270
2023.11.10  0.87255 0.87552 0.87164 0.87365
2023.11.13  0.87388 0.87422 0.87074 0.87115
2023.11.14  0.87124 0.87305 0.86884 0.87020
2023.11.15  0.87010 0.87400 0.86978 0.87343
2023.11.16  0.87297 0.87654 0.87212 0.87400
2023.11.17  0.87313 0.87626 0.87283 0.87551
2023.11.20  0.87534 0.87649 0.87416 0.87473
2023.11.21  0.87384 0.87515 0.87006 0.87007
2023.11.22  0.87031 0.87249 0.86916 0.87143
2023.11.23  0.87126 0.87239 0.86867 0.86990
2023.11.24  0.86990 0.87068 0.86701 0.86726
2023.11.27  0.86812 0.86879 0.86575 0.86732
2023.11.28  0.86720 0.86832 0.86544 0.86582
2023.11.29  0.86534 0.86624 0.86361 0.86398
2023.11.30  0.86402 0.86494 0.86134 0.86231
2023.12.01  0.86144 0.86350 0.85564 0.85575
2023.12.04  0.85624 0.85855 0.85537 0.85762
2023.12.05  0.85727 0.85883 0.85646 0.85707
2023.12.06  0.85658 0.85744 0.85490 0.85693
2023.12.07  0.85690 0.85842 0.85546 0.85699
2023.12.08  0.85658 0.85883 0.85545 0.85719
2023.12.11  0.85734 0.85885 0.85491 0.85720
2023.12.12  0.85707 0.86085 0.85476 0.85899
2023.12.13  0.85861 0.86293 0.85755 0.86169
2023.12.14  0.86147 0.86342 0.85868 0.86070
2023.12.15  0.86012 0.86172 0.85708 0.85879
2023.12.18  0.85759 0.86460 0.85759 0.86344
2023.12.19  0.86326 0.86367 0.85978 0.86227
2023.12.20  0.86182 0.86682 0.86126 0.86566
2023.12.21  0.86492 0.86850 0.86448 0.86752
2023.12.22  0.86736 0.86797 0.86500 0.86703
2023.12.25  0.86663 0.86772 0.86372 0.86562
2023.12.26  0.86700 0.86860 0.86602 0.86752
2023.12.27  0.86749 0.86986 0.86559 0.86753
2023.12.28  0.86748 0.87143 0.86685 0.86861
2023.12.29  0.86850 0.87007 0.86591 0.86672
2024.01.02  0.86724 0.86822 0.86454 0.86705
2024.01.03  0.86705 0.86758 0.86166 0.86230
2024.01.04  0.86188 0.86391 0.86045 0.86287
2024.01.05  0.86209 0.86336 0.85982 0.86020
2024.01.08  0.85958 0.86205 0.85754 0.85889
2024.01.09  0.85910 0.86071 0.85829 0.85999
2024.01.10  0.86001 0.86202 0.85936 0.86106
2024.01.11  0.86096 0.86169 0.85928 0.86006
2024.01.12  0.85939 0.86063 0.85825 0.85847
2024.01.15  0.85768 0.86114 0.85755 0.86007
2024.01.16  0.86004 0.86197 0.85889 0.86054
2024.01.17  0.86030 0.86180 0.85674 0.85833
2024.01.18  0.85830 0.85911 0.85546 0.85592
2024.01.19  0.85565 0.85926 0.85508 0.85767
2024.01.22  0.85747 0.85825 0.85547 0.85623
2024.01.23  0.85620 0.85648 0.85461 0.85546
2024.01.24  0.85542 0.85609 0.85354 0.85521
2024.01.25  0.85508 0.85638 0.85205 0.85335
2024.01.26  0.85336 0.85476 0.85156 0.85413
2024.01.29  0.85401 0.85445 0.85128 0.85236
2024.01.30  0.85230 0.85673 0.85129 0.85397
2024.01.31  0.85323 0.85474 0.85225 0.85253
2024.02.01  0.85271 0.85581 0.85198 0.85301
2024.02.02  0.85292 0.85475 0.85202 0.85376
2024.02.05  0.85301 0.85715 0.85250 0.85679
2024.02.06  0.85662 0.85706 0.85328 0.85358
2024.02.07  0.85351 0.85396 0.85157 0.85305
2024.02.08  0.85297 0.85443 0.85208 0.85405
2024.02.09  0.85374 0.85467 0.85270 0.85377
2024.02.12  0.85333 0.85466 0.85270 0.85291
2024.02.13  0.85298 0.85346 0.84996 0.85032
2024.02.14  0.85033 0.85482 0.84946 0.85369
2024.02.15  0.85370 0.85697 0.85288 0.85491
2024.02.16  0.85486 0.85647 0.85367 0.85512
2024.02.19  0.85450 0.85593 0.85359 0.85548
2024.02.20  0.85541 0.85777 0.85454 0.85611
2024.02.21  0.85608 0.85711 0.85557 0.85603
2024.02.22  0.85602 0.85745 0.85449 0.85478
2024.02.23  0.85474 0.85511 0.85276 0.85333
2024.02.26  0.85384 0.85606 0.85289 0.85534
2024.02.27  0.85533 0.85667 0.85454 0.85479
2024.02.28  0.85476 0.85649 0.85444 0.85586
2024.02.29  0.85590 0.85699 0.85500 0.85559
2024.03.01  0.85579 0.85754 0.85497 0.85634
2024.03.04  0.85597 0.85670 0.85488 0.85517
2024.03.05  0.85509 0.85602 0.85343 0.85412
2024.03.06  0.85413 0.85619 0.85397 0.85591
2024.03.07  0.85603 0.85627 0.85233 0.85443
2024.03.08  0.85441 0.85480 0.85035 0.85052
2024.03.11  0.85073 0.85345 0.85057 0.85261
2024.03.12  0.85261 0.85546 0.85250 0.85387
2024.03.13  0.85387 0.85597 0.85383 0.85533
2024.03.14  0.85533 0.85568 0.85277 0.85316
2024.03.15  0.85314 0.85531 0.85314 0.85460
2024.03.18  0.85466 0.85624 0.85341 0.85402
2024.03.19  0.85414 0.85558 0.85323 0.85388
2024.03.20  0.85389 0.85581 0.85358 0.85414
2024.03.21  0.85415 0.85828 0.85300 0.85795
2024.03.22  0.85787 0.86022 0.85675 0.85758
2024.03.25  0.85772 0.85846 0.85652 0.85736
2024.03.26  0.85736 0.85883 0.85670 0.85756
2024.03.27  0.85749 0.85852 0.85626 0.85656
2024.03.28  0.85655 0.85708 0.85393 0.85453
2024.03.29  0.85454 0.85561 0.85297 0.85477
2024.04.01  0.85335 0.85631 0.85260 0.85583
2024.04.02  0.85562 0.85750 0.85276 0.85605
2024.04.03  0.85608 0.85821 0.85570 0.85635
2024.04.04  0.85641 0.85806 0.85587 0.85713
2024.04.05  0.85714 0.85861 0.85657 0.85733
2024.04.08  0.85756 0.85844 0.85737 0.85802
2024.04.09  0.85803 0.85823 0.85613 0.85630
2024.04.10  0.85631 0.85709 0.85466 0.85653
2024.04.11  0.85658 0.85699 0.85420 0.85434
2024.04.12  0.85433 0.85518 0.85284 0.85456
2024.04.15  0.85430 0.85526 0.85271 0.85352
2024.04.16  0.85355 0.85500 0.85279 0.85440
2024.04.17  0.85441 0.85721 0.85209 0.85689
2024.04.18  0.85672 0.85712 0.85512 0.85568
2024.04.19  0.85574 0.86156 0.85473 0.86132
2024.04.22  0.86080 0.86441 0.85947 0.86256
2024.04.23  0.86286 0.86445 0.85933 0.85944
2024.04.24  0.85951 0.86000 0.85828 0.85834
2024.04.25  0.85838 0.85921 0.85647 0.85735
2024.04.26  0.85716 0.85838 0.85569 0.85570
2024.04.29  0.85670 0.85670 0.85325 0.85332
2024.04.30  0.85333 0.85548 0.85292 0.85369
2024.05.01  0.85366 0.85584 0.85296 0.85515
2024.05.02  0.85502 0.85650 0.85450 0.85561
2024.05.03  0.85545 0.85864 0.85485 0.85765
2024.05.06  0.85747 0.85814 0.85570 0.85717
2024.05.07  0.85696 0.85992 0.85605 0.85966
2024.05.08  0.85970 0.86179 0.85863 0.85989
2024.05.09  0.85952 0.86200 0.85909 0.86084
2024.05.10  0.86049 0.86106 0.85926 0.85981
2024.05.13  0.85958 0.86087 0.85890 0.85904
2024.05.14  0.85910 0.86141 0.85842 0.85919
2024.05.15  0.85869 0.86000 0.85750 0.85785
2024.05.16  0.85775 0.85875 0.85708 0.85766
2024.05.17  0.85768 0.85804 0.85545 0.85563
2024.05.20  0.85610 0.85679 0.85414 0.85440
2024.05.21  0.85417 0.85511 0.85335 0.85393
2024.05.22  0.85383 0.85417 0.85036 0.85096
2024.05.23  0.85096 0.85273 0.84999 0.85160
2024.05.24  0.85162 0.85319 0.85089 0.85140
2024.05.27  0.85160 0.85202 0.84967 0.84997
2024.05.28  0.84985 0.85178 0.84946 0.85066
2024.05.29  0.85058 0.85169 0.84838 0.85038
2024.05.30  0.85008 0.85172 0.84918 0.85072
2024.05.31  0.85087 0.85405 0.84994 0.85124
2024.06.03  0.85160 0.85354 0.85067 0.85128
2024.06.04  0.85091 0.85247 0.85052 0.85176
2024.06.05  0.85133 0.85205 0.84978 0.84990
2024.06.06  0.84995 0.85246 0.84946 0.85123
2024.06.07  0.85125 0.85203 0.84874 0.84874
2024.06.10  0.84592 0.84717 0.84400 0.84553
2024.06.11  0.84525 0.84678 0.84181 0.84295
2024.06.12  0.84293 0.84516 0.84156 0.84448
2024.06.13  0.84417 0.84579 0.84110 0.84121
2024.06.14  0.84130 0.84408 0.83974 0.84332
2024.06.17  0.84290 0.84614 0.84231 0.84480
2024.06.18  0.84475 0.84645 0.84411 0.84494
2024.06.19  0.84460 0.84546 0.84300 0.84467
2024.06.20  0.84451 0.84609 0.84345 0.84541
2024.06.21  0.84543 0.84650 0.84426 0.84527
2024.06.24  0.84500 0.84776 0.84458 0.84591
2024.06.25  0.84557 0.84633 0.84306 0.84445
2024.06.26  0.84439 0.84633 0.84308 0.84600
2024.06.27  0.84544 0.84752 0.84527 0.84682
2024.06.28  0.84685 0.84816 0.84576 0.84699
2024.07.01  0.84920 0.84988 0.84701 0.84891
2024.07.02  0.84898 0.84952 0.84803 0.84858
2024.07.03  0.84698 0.84780 0.84572 0.84639
2024.07.04  0.84619 0.84741 0.84495 0.84706
2024.07.05  0.84722 0.84780 0.84513 0.84561
2024.07.08  0.84370 0.84598 0.84311 0.84509
2024.07.09  0.84488 0.84597 0.84419 0.84566
2024.07.10  0.84576 0.84590 0.84252 0.84276
2024.07.11  0.84235 0.84318 0.84129 0.84143
2024.07.12  0.84121 0.84214 0.83915 0.83933
2024.07.15  0.83874 0.84115 0.83855 0.84007
2024.07.16  0.83982 0.84104 0.83958 0.84004
2024.07.17  0.84007 0.84100 0.83828 0.84086
2024.07.18  0.84081 0.84220 0.84025 0.84175
2024.07.19  0.84156 0.84326 0.84100 0.84242
2024.07.22  0.84270 0.84312 0.84134 0.84201
2024.07.23  0.84173 0.84263 0.83972 0.84078
2024.07.24  0.84037 0.84176 0.83925 0.83980
2024.07.25  0.83955 0.84397 0.83913 0.84380
2024.07.26  0.84371 0.84490 0.84277 0.84362
2024.07.29  0.84339 0.84604 0.84115 0.84126
2024.07.30  0.84129 0.84292 0.84077 0.84250
2024.07.31  0.84224 0.84485 0.84168 0.84194
2024.08.01  0.84176 0.84732 0.84146 0.84696
2024.08.02  0.84672 0.85346 0.84538 0.85171
2024.08.05  0.85290 0.86190 0.85175 0.85690
2024.08.06  0.85675 0.86157 0.85614 0.86092
2024.08.07  0.86089 0.86144 0.85757 0.86049
2024.08.08  0.86043 0.86244 0.85598 0.85627
2024.08.09  0.85617 0.85781 0.85496 0.85547
2024.08.12  0.85544 0.85680 0.85432 0.85586
2024.08.13  0.85589 0.85645 0.85304 0.85449
2024.08.14  0.85409 0.85919 0.85362 0.85784
2024.08.15  0.85821 0.85868 0.85337 0.85348
2024.08.16  0.85344 0.85360 0.85099 0.85153
2024.08.19  0.85142 0.85331 0.85077 0.85298
2024.08.20  0.85324 0.85393 0.85148 0.85377
2024.08.21  0.85376 0.85438 0.85086 0.85150
2024.08.22  0.85159 0.85218 0.84780 0.84877
2024.08.23  0.84852 0.84921 0.84516 0.84652
2024.08.26  0.84580 0.84746 0.84496 0.84608
2024.08.27  0.84586 0.84670 0.84307 0.84328
2024.08.28  0.84341 0.84358 0.84095 0.84290
2024.08.29  0.84259 0.84336 0.84019 0.84121
2024.08.30  0.84099 0.84272 0.83987 0.84135
2024.09.02  0.84160 0.84319 0.84044 0.84202
2024.09.03  0.84217 0.84340 0.84053 0.84195
2024.09.04  0.84206 0.84346 0.84138 0.84283
2024.09.05  0.84280 0.84372 0.84175 0.84290
2024.09.06  0.84298 0.84461 0.84109 0.84407
2024.09.09  0.84400 0.84465 0.84324 0.84391
2024.09.10  0.84366 0.84470 0.84225 0.84227
2024.09.11  0.84222 0.84627 0.84179 0.84420
2024.09.12  0.84405 0.84548 0.84328 0.84361
2024.09.13  0.84365 0.84523 0.84266 0.84383
2024.09.16  0.84340 0.84430 0.84193 0.84221
2024.09.17  0.84190 0.84535 0.84177 0.84427
2024.09.18  0.84402 0.84525 0.84035 0.84132
2024.09.19  0.84140 0.84229 0.83911 0.84009
2024.09.20  0.83990 0.84060 0.83762 0.83781
2024.09.23  0.83771 0.83860 0.83217 0.83221
2024.09.24  0.83225 0.83388 0.83164 0.83339
2024.09.25  0.83316 0.83712 0.83304 0.83539
2024.09.26  0.83509 0.83598 0.83262 0.83302
2024.09.27  0.83266 0.83491 0.83212 0.83462
2024.09.30  0.83417 0.83594 0.83120 0.83232
2024.10.01  0.83206 0.83447 0.83102 0.83298
2024.10.02  0.83274 0.83375 0.83208 0.83230
2024.10.03  0.83206 0.84335 0.83181 0.84031
2024.10.04  0.84040 0.84062 0.83523 0.83603
2024.10.07  0.83620 0.83989 0.83467 0.83869
2024.10.08  0.83835 0.84040 0.83732 0.83748
2024.10.09  0.83737 0.83878 0.83657 0.83671
2024.10.10  0.83660 0.83844 0.83537 0.83692
2024.10.11  0.83701 0.83825 0.83638 0.83668
2024.10.14  0.83621 0.83730 0.83480 0.83514
2024.10.15  0.83518 0.83522 0.83246 0.83306
2024.10.16  0.83310 0.83794 0.83228 0.83613
2024.10.17  0.83573 0.83660 0.83175 0.83224
2024.10.18  0.83133 0.83354 0.82945 0.83260
2024.10.21  0.83280 0.83387 0.83048 0.83281
2024.10.22  0.83282 0.83459 0.83131 0.83152
2024.10.23  0.83158 0.83439 0.83028 0.83431
2024.10.24  0.83428 0.83518 0.83136 0.83439
2024.10.25  0.83420 0.83492 0.83257 0.83283
2024.10.28  0.83202 0.83426 0.83183 0.83366
2024.10.29  0.83367 0.83398 0.82983 0.83100
2024.10.30  0.83100 0.83765 0.83098 0.83691
2024.10.31  0.83718 0.84471 0.83527 0.84364
2024.11.01  0.84355 0.84423 0.83686 0.83836
2024.11.04  0.83770 0.84182 0.83674 0.83941
2024.11.05  0.83919 0.83976 0.83774 0.83804
2024.11.06  0.83769 0.83844 0.83138 0.83303
2024.11.07  0.83305 0.83394 0.83057 0.83180
2024.11.08  0.83176 0.83250 0.82917 0.82941
2024.11.11  0.82950 0.83012 0.82594 0.82786
2024.11.12  0.82759 0.83342 0.82654 0.83323
2024.11.13  0.83297 0.83448 0.83068 0.83096
2024.11.14  0.83106 0.83231 0.83027 0.83110
2024.11.15  0.83089 0.83585 0.83051 0.83491
2024.11.18  0.83484 0.83726 0.83296 0.83579
2024.11.19  0.83576 0.83750 0.83315 0.83533
2024.11.20  0.83521 0.83581 0.83124 0.83310
2024.11.21  0.83262 0.83403 0.83164 0.83186
2024.11.22  0.83124 0.83460 0.82674 0.83104
2024.11.25  0.83198 0.83606 0.83061 0.83493
2024.11.26  0.83366 0.83640 0.83298 0.83421
2024.11.27  0.83376 0.83550 0.83307 0.83308
2024.11.28  0.83224 0.83386 0.83143 0.83171
2024.11.29  0.83150 0.83310 0.82967 0.82992
2024.12.02  0.83070 0.83070 0.82693 0.82932
2024.12.03  0.82894 0.83119 0.82746 0.82868
2024.12.04  0.82842 0.83011 0.82683 0.82709
2024.12.05  0.82708 0.83010 0.82618 0.82921
2024.12.06  0.82845 0.82998 0.82788 0.82912
2024.12.09  0.82804 0.82896 0.82686 0.82717
2024.12.10  0.82721 0.82826 0.82373 0.82376
2024.12.11  0.82383 0.82510 0.82246 0.82267
2024.12.12  0.82202 0.82718 0.82199 0.82544
2024.12.13  0.82528 0.83209 0.82287 0.83199
2024.12.16  0.82941 0.83271 0.82725 0.82815
2024.12.17  0.82766 0.82950 0.82481 0.82492
2024.12.18  0.82448 0.82773 0.82280 0.82297
2024.12.19  0.82261 0.82922 0.82216 0.82833
2024.12.20  0.82835 0.83121 0.82702 0.82961
2024.12.23  0.82990 0.83126 0.82770 0.82949
2024.12.24  0.82850 0.83025 0.82744 0.82747
2024.12.25  0.82752 0.82829 0.82720 0.82829
2024.12.26  0.82870 0.83238 0.82770 0.83140
2024.12.27  0.83081 0.83277 0.82814 0.82866
2024.12.30  0.82839 0.82986 0.82717 0.82882
2024.12.31  0.82899 0.83070 0.82623 0.82710
2025.01.01  0.82789 0.82789 0.82789 0.82789
2025.01.02  0.82645 0.83246 0.82621 0.82832
2025.01.03  0.82804 0.83025 0.82772 0.82966
2025.01.06  0.82816 0.83168 0.82770 0.82912
2025.01.07  0.82923 0.83049 0.82819 0.82845
2025.01.08  0.82822 0.83513 0.82818 0.83411
"""

############################################################################
# 2) PARSE DATA INTO DataFrame
############################################################################

def parse_data(data_str):
    lines = data_str.strip().split('\n')
    rows = []
    for line in lines:
        # skip any line that is obviously a header or blank
        if "DATE" in line or not line.strip():
            continue
        parts = line.split()
        if len(parts) < 5:
            continue

        # Example line: 2023.01.02    0.88524    0.88740    0.88381    0.88530
        date_str = parts[0]
        open_ = float(parts[1])
        high_ = float(parts[2])
        low_  = float(parts[3])
        close_= float(parts[4])

        # Convert date_str like 2023.01.02 => "2023-01-02"
        date_str_clean = date_str.replace('.', '-')
        dt = datetime.strptime(date_str_clean, "%Y-%m-%d")
        rows.append([dt, open_, high_, low_, close_])

    df = pd.DataFrame(rows, columns=['Date','Open','High','Low','Close'])
    df.sort_values('Date', inplace=True)
    df.set_index('Date', inplace=True)
    return df

############################################################################
# 3) CREATE SUPERVISED DATA
############################################################################

def create_supervised_data(df):
    """
    We want to predict if tomorrow's candle is bullish or bearish:
        - Bullish => next Close > next Open
        - Bearish => next Close <= next Open

    We'll also do a regression for next day's closing price.

    X(t) = [ today's Open, today's Close, (Close-Open), tomorrow's Open ]
    y_class(t) = 1 if (Close_{t+1} > Open_{t+1}) else 0
    y_reg(t)   = next day's closing price (Close_{t+1})

    We'll skip the final row because it has no "tomorrow."
    """
    # shift columns to get "tomorrow's" open/close
    df['Open_tom']  = df['Open'].shift(-1)
    df['Close_tom'] = df['Close'].shift(-1)

    X_list = []
    y_cl_list = []
    y_rg_list = []

    for i in range(len(df)-1):
        open_today  = df['Open'].iloc[i]
        close_today = df['Close'].iloc[i]
        open_tom    = df['Open_tom'].iloc[i]
        close_tom   = df['Close_tom'].iloc[i]

        # Classification label
        is_bullish = 1 if close_tom > open_tom else 0

        # Feature vector
        feat = [
            open_today,
            close_today,
            (close_today - open_today),
            open_tom
        ]

        X_list.append(feat)
        y_cl_list.append(is_bullish)
        y_rg_list.append(close_tom)

    # Convert to numpy arrays
    X_arr   = np.array(X_list, dtype=float)
    y_class = np.array(y_cl_list, dtype=int)
    y_reg   = np.array(y_rg_list, dtype=float)

    return X_arr, y_class, y_reg

############################################################################
# 4) INCREMENTAL TRAIN & PREDICT
############################################################################

def incremental_train_and_predict(X, y_class, y_reg):
    """
    We'll do a walk-forward approach with incremental updates:
      - Use SGDClassifier (log-loss => logistic regression) for bullish/bearish
      - Use SGDRegressor for the next day closing price
      - Start training with the first 'min_train_size' samples,
        then for each subsequent day, predict => record => partial_fit with actual result
    """
    n = len(X)
    if n < 5:
        print("Not enough data to do incremental training. Exiting.")
        return None

    min_train_size = 20

    # NOTE: The only fix here is changing 'loss' from 'log' to 'log_loss':
    clf = SGDClassifier(loss='log_loss', max_iter=2000, tol=1e-6, penalty='l2')
    reg = SGDRegressor(penalty='l2', max_iter=2000, tol=1e-6)

    # Warm-up train on first min_train_size
    X0 = X[:min_train_size]
    y0_cl = y_class[:min_train_size]
    y0_rg = y_reg[:min_train_size]

    clf.fit(X0, y0_cl)
    reg.fit(X0, y0_rg)

    # We'll store predictions for i in [min_train_size .. n-1]
    pred_cls_list   = []
    prob_bull_list  = []
    pred_close_list = []

    idx_list = []

    for i in range(min_train_size, n):
        x_i = X[i].reshape(1,-1)

        # Probability: predict_proba
        proba = clf.predict_proba(x_i)[0]
        # Probability of "bullish" (class=1) is proba[1]
        p_bull = proba[1]
        pred_cls = 1 if p_bull >= 0.5 else 0

        # Regression
        p_close = reg.predict(x_i)[0]

        pred_cls_list.append(pred_cls)
        prob_bull_list.append(p_bull)
        pred_close_list.append(p_close)
        idx_list.append(i)

        # Now partial-fit with the real outcome
        real_cl = y_class[i]
        real_rg = y_reg[i]

        clf.partial_fit(x_i, [real_cl], classes=[0,1])
        reg.partial_fit(x_i, [real_rg])

    # Save results in DataFrame
    df_out = pd.DataFrame({
        'Index'         : idx_list,
        'Actual_Bullish': y_class[idx_list],
        'Pred_Bullish'  : pred_cls_list,
        'Prob_Bullish'  : prob_bull_list,
        'Actual_Close'  : y_reg[idx_list],
        'Pred_Close'    : pred_close_list
    })

    return df_out

############################################################################
# 5) MAIN PIPELINE
############################################################################

def main_prediction_pipeline():
    # 1) parse data
    df = parse_data(DATA)

    # 2) create features/labels
    X, y_cl, y_rg = create_supervised_data(df)

    # 3) incremental train/predict
    df_result = incremental_train_and_predict(X, y_cl, y_rg)
    if df_result is None:
        print("No results to show (not enough data).")
        return

    # Show final portion
    print("\n=== FINAL RESULTS (Rolling Incremental Approach) ===")
    print(df_result.tail(10))

    # If you want to show the last row's predictions specifically:
    last_row = df_result.iloc[-1]
    final_idx  = int(last_row['Index'])
    real_bull  = last_row['Actual_Bullish']
    pred_bull  = last_row['Pred_Bullish']
    prob_bull  = last_row['Prob_Bullish']
    act_close  = last_row['Actual_Close']
    pred_close = last_row['Pred_Close']

    conf_percent = prob_bull * 100.0

    # Summarize final
    print("\n--- FINAL PREDICTION FOR SAMPLE INDEX", final_idx, "---")
    print("Actual Bullish?   ", real_bull, "(1=Yes,0=No)")
    print("Predicted Bullish?", pred_bull, "(Confidence=%.2f%%)" % conf_percent)
    print("Actual Close:     ", act_close)
    print("Predicted Close:  ", pred_close)


if __name__ == "__main__":
    main_prediction_pipeline()
